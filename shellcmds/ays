#!/usr/bin/env jspython

from JumpScale import j

import click

@click.group()
def cli():
    pass

@click.command()
@click.argument('role')
@click.argument('instance')
@click.option('--count', default=1, help='number of instances you want to create, default is 1')
@click.option('--domain', default="", help='optional domain of ays')
@click.option('--version', default="", help='optional version of ays')
def new(role,instance,count=1,domain="",version=""):
    """
    @arg role: name of role of instance you want to create
    @arg instance: the name for the instance 
    """
    from ptpython.repl import embed
    print ("DEBUG NOW new")
    embed(globals(), locals())
    
    click.echo('new')

@click.command()
def init():
    """
    as first step this command will look for blueprints (they are in your ays repo under path $aysdir/blueprints)
    they will be processed in sorted order
    the blueprints will be converted to ays instances
    the changes with before (last time you did an init) will be shown
    """
    chfiles=j.atyourservice.init()
    # chfiles.sort()
    # for item in chfiles:
    #     print ("- %s"%item)


@click.command()
@click.argument('action')
@click.option('--printonly', default=False, help='if set will not really execute, only show what would have been done')
def do(action,printonly=False):
    j.atyourservice.do(action,printonly=printonly)


cli.add_command(new)
cli.add_command(init)
cli.add_command(do)

@click.command()
@click.argument('role')
@click.argument('instance')
def showproducers(role,instance):
    print ("producers:")
    ays=j.atyourservice.getService(role,instance)
    ays.printProducersRecursive()

@click.command()
@click.argument('role')
@click.argument('instance')
def showparents(role,instance):
    ays=j.atyourservice.getService(role,instance)
    out="parents:\n"
    for parent in ays.parents:
        out+="- %s\n"%parent
    print (out)


cli.add_command(new)
cli.add_command(init)
cli.add_command(do)
cli.add_command(showproducers)
cli.add_command(showparents)

if __name__ == '__main__':
    j.atyourservice.debug=True
    cli()

# j.application.stop()
# j.logger.enabled = False
